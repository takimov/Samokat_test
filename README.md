# Samokat_test

Для установки необходимых библиотек: `pip install -r requirements.txt`

Файл с ответами на test.csv: `test_answer.csv`

## Выводы на основе анализа данных:
1. Большинство рядов стационарные.
2. Ряды между собой сильно скоррелированы.
3. Существует сезонность
4. Отсутствует явно выраженный тренд


## Используемые модели и стратегия валидации:
Для валидации моделей будем использовать TimeSeriesSplit - кросс-валидация временного ряда на k фолдах(k = 3). Данная стратегия поможет учесть то, как модель справляется с прогнозом на разных участках временного ряда.

В качестве модели возьмем бустинг - CatBoost. Модель имеет хорошую обобщающую способность и является лучшей среди Classic ML моделей, а также справляется в некоторых задачах прогноза гораздо лучше, чем GARCH, AR или MA модели. В нашей задаче мы имеем достаточную длину ряда, чтобы использовать бустинг(в сегментах, попадающих в No Space). Модель будем использовать в двух стратегиях - рекурсивной и прямой.

## Выбор гиперпараметров:

Будем подбирать гиперпараметры для CatBoost и наших признаков(transforms) с помощью библиотеки optuna, которая позволяет эффективно перебирать параметры, в отличии от обычной кросс-валидации по сетке.

## Выводы по исследованию:
1. Выявлены 2 разные подвыборки: 5 сегментов имели большой пропуск в данных(~полгода). Поэтому было принято решение о разделении выборок и впоследствии раздельного анализа.

2. Проведен анализ временных рядов по каждому сегменту(магазину): выявлена высокая скоррелированность, стационарность, а также проведен анализ ACF. Помимо этого был проведен анализ сезонности и выявления трендов в каждом сегменте. Модели, предполагающие корреляцию между рядами не были использованы(например, VAR модель), однако в большинстве случаев они имеют худшее качество по сравнению с бустингом или улучшенными версиями ARIMA-моделей. Выявление стационарности с помощью ADF-теста помогло в использовании ARIMA модели. Анализ ACF показал, что существуют взаимосвязи между прошлыми значениями, а также дало уверенность в том, что добавления лаговых значений в модель будет иметь смысл. Были использованы довольно поздние лаги(> 14 дней), так как на них показывалось лучшее качество(SMAPE, sMAE). Выявление тренда не показало ощутимых результатов, однако помогло при сборке признаков. Проверка на сезонность позволила добавить сезонную компоненту в качестве отдельного признака, что улучшило результаты модели.

3. При выборе модели участвовало 3 типа: прямая стратегия с использованием бустинга, рекурсивная стратегия с использованием бустинга, а также ARIMA. На больших временных рядах использовались стратегии(15 сегментов), на коротких - ARIMA. Для каждого сегмента была взята отдельная модель с отдельной стратегией прогнозирования, для ARIMA моделей были перебраны значения p,d,q по AIC. 

4. Подбор гиперпараметров был использован как для признаков, так и для самого бустинга. Подбор осуществлялся с помощью `optuna` с `n_trials` = 10. Были подобраны оптимальные значения для данной выборки.

5. Базовые модели имеют sMAE < 0.15, Наивная модель посегментно имеет sMAE ~ больше 0.2.
